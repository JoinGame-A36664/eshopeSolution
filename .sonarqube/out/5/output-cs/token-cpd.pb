ä
eF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Controllers\BaseController.cs
	namespace 	
eShopSolution
 
. 
AdminApp  
.  !
Controllers! ,
{ 
[ 
	Authorize 
] 
public		 

class		 
BaseController		 
:		  !

Controller		" ,
{

 
public 
override 
void 
OnActionExecuting .
(. /"
ActionExecutingContext/ E
contextF M
)M N
{ 	
var 
sessions 
= 
context "
." #
HttpContext# .
.. /
Session/ 6
.6 7
	GetString7 @
(@ A
$strA H
)H I
;I J
if 
( 
sessions 
== 
null  
)  !
{ 
context 
. 
Result 
=  
new! $"
RedirectToActionResult% ;
(; <
$str< C
,C D
$strE L
,L M
nullN R
)R S
;S T
} 
base 
. 
OnActionExecuting "
(" #
context# *
)* +
;+ ,
} 	
} 
} π
yF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Controllers\Components\NavigationViewComponent.cs
	namespace 	
eShopSolution
 
. 
AdminApp  
.  !
Controllers! ,
., -

Components- 7
{		 
public

 

class

 #
NavigationViewComponent

 (
:

) *
ViewComponent

+ 8
{ 
private 
readonly 
ILanguageApiClient +
_languageApiClient, >
;> ?
public #
NavigationViewComponent &
(& '
ILanguageApiClient' 9
languageApiClient: K
)K L
{ 	
_languageApiClient 
=  
languageApiClient! 2
;2 3
} 	
public 
async 
Task 
<  
IViewComponentResult .
>. /
InvokeAsync0 ;
(; <
)< =
{ 	
var 
	languages 
= 
await !
_languageApiClient" 4
.4 5
GetAll5 ;
(; <
)< =
;= >
var 
navigationVm 
= 
new "
NavigationViewModel# 6
(6 7
)7 8
{ 
CurrentLanguageId !
=" #
HttpContext$ /
. 
Session 
. 
	GetString 
( 
SystemConstants *
.* +
AppSettings+ 6
.6 7
DefaultLanguageId7 H
)H I
,I J
	Languages 
= 
	languages %
.% &
	ResultObj& /
} 
; 
return 
View 
( 
$str !
,! "
navigationVm# /
)/ 0
;0 1
} 	
}   
}!! œ
tF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Controllers\Components\PagerViewComponent.cs
	namespace 	
eShopeSolution
 
. 
	AddminApp "
." #
Controllers# .
.. /

Components/ 9
{ 
public 

class 
PagerViewComponent #
:$ %
ViewComponent& 3
{ 
public		 
Task		 
<		  
IViewComponentResult		 (
>		( )
InvokeAsync		* 5
(		5 6
PageResultBase		6 D
result		E K
)		K L
{

 	
return 
Task 
. 

FromResult "
(" #
(# $ 
IViewComponentResult$ 8
)8 9
View9 =
(= >
$str> G
,G H
resultI O
)O P
)P Q
;Q R
} 	
} 
} Ü
eF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Controllers\HomeController.cs
	namespace		 	
eShopeSolution		
 
.		 
	AddminApp		 "
.		" #
Controllers		# .
{

 
public 

class 
HomeController 
:  !
BaseController" 0
{ 
private 
readonly 
ILogger  
<  !
HomeController! /
>/ 0
_logger1 8
;8 9
public 
HomeController 
( 
ILogger %
<% &
HomeController& 4
>4 5
logger6 <
)< =
{ 	
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public 
IActionResult 
Privacy $
($ %
)% &
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public 
IActionResult 
Error "
(" #
)# $
{   	
return!! 
View!! 
(!! 
new!! 
ErrorViewModel!! *
{!!+ ,
	RequestId!!- 6
=!!7 8
Activity!!9 A
.!!A B
Current!!B I
?!!I J
.!!J K
Id!!K M
??!!N P
HttpContext!!Q \
.!!\ ]
TraceIdentifier!!] l
}!!m n
)!!n o
;!!o p
}"" 	
[$$ 	
HttpPost$$	 
]$$ 
public%% 
IActionResult%% 
Language%% %
(%%% &
NavigationViewModel%%& 9
	viewModel%%: C
)%%C D
{&& 	
HttpContext'' 
.'' 
Session'' 
.''  
	SetString''  )
('') *
SystemConstants''* 9
.''9 :
AppSettings'': E
.''E F
DefaultLanguageId''F W
,''W X
	viewModel''Y b
.''b c
CurrentLanguageId''c t
)''t u
;''u v
return(( 
Redirect(( 
((( 
	viewModel(( %
.((% &
	ReturnUrl((& /
)((/ 0
;((0 1
})) 	
}** 
}++ å4
fF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Controllers\LoginController.cs
	namespace 	
eShopeSolution
 
. 
	AddminApp "
." #
Controllers# .
{ 
public 

class 
LoginController  
:! "

Controller# -
{ 
private 
readonly 
IUserApiClient '
_userApiClient( 6
;6 7
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public 
LoginController 
( 
IUserApiClient -
userApiClient. ;
,; <
IConfiguration= K
configurationL Y
)Y Z
{ 	
_userApiClient 
= 
userApiClient *
;* +
_configuration 
= 
configuration *
;* +
} 	
["" 	
HttpGet""	 
]"" 
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
Index##) .
(##. /
)##/ 0
{$$ 	
await&& 
HttpContext&& 
.&& 
SignOutAsync&& *
(&&* +(
CookieAuthenticationDefaults&&+ G
.&&G H 
AuthenticationScheme&&H \
)&&\ ]
;&&] ^
return'' 
View'' 
('' 
)'' 
;'' 
}(( 	
[** 	
HttpPost**	 
]** 
public++ 
async++ 
Task++ 
<++ 
IActionResult++ '
>++' (
Index++) .
(++. /
LoginRequest++/ ;
request++< C
)++C D
{,, 	
if-- 
(-- 
!-- 

ModelState-- 
.-- 
IsValid-- #
)--# $
{.. 

ModelState// 
.// 
AddModelError// (
(//( )
$str//) +
,//+ ,
$str//- T
)//T U
;//U V
return00 
View00 
(00 
)00 
;00 
}11 
var33 
result33 
=33 
await33 
_userApiClient33 -
.33- .
Authenticate33. :
(33: ;
request33; B
)33B C
;33C D
if66 
(66 
result66 
.66 
	ResultObj66  
==66! #
null66$ (
)66( )
{77 

ModelState88 
.88 
AddModelError88 (
(88( )
$str88) +
,88+ ,
result88- 3
.883 4
Message884 ;
)88; <
;88< =
return99 
View99 
(99 
)99 
;99 
}:: 
var== 
userPrincipal== 
=== 
this==  $
.==$ %
ValidateToken==% 2
(==2 3
result==3 9
.==9 :
	ResultObj==: C
)==C D
;==D E
var@@ 
authProperties@@ 
=@@  
new@@! $$
AuthenticationProperties@@% =
{AA 

ExpiresUtcBB 
=BB 
DateTimeOffsetBB +
.BB+ ,
UtcNowBB, 2
.BB2 3

AddMinutesBB3 =
(BB= >
$numBB> @
)BB@ A
,BBA B
IsPersistentCC 
=CC 
falseCC $
}DD 
;DD 
HttpContextFF 
.FF 
SessionFF 
.FF  
	SetStringFF  )
(FF) *
SystemConstantsFF* 9
.FF9 :
AppSettingsFF: E
.FFE F
DefaultLanguageIdFFF W
,FFW X
_configurationFFY g
[FFg h
SystemConstantsFFh w
.FFw x
AppSettings	FFx É
.
FFÉ Ñ
DefaultLanguageId
FFÑ ï
]
FFï ñ
)
FFñ ó
;
FFó ò
HttpContextHH 
.HH 
SessionHH 
.HH  
	SetStringHH  )
(HH) *
SystemConstantsHH* 9
.HH9 :
AppSettingsHH: E
.HHE F
TokenHHF K
,HHK L
resultHHM S
.HHS T
	ResultObjHHT ]
)HH] ^
;HH^ _
awaitKK 
HttpContextKK 
.KK 
SignInAsyncKK )
(KK) *(
CookieAuthenticationDefaultsLL 0
.LL0 1 
AuthenticationSchemeLL1 E
,LLE F
userPrincipalMM !
,MM! "
authPropertiesNN "
)NN" #
;NN# $
returnPP 
RedirectToActionPP #
(PP# $
$strPP$ +
,PP+ ,
$strPP- 3
)PP3 4
;PP4 5
}QQ 	
privateTT 
ClaimsPrincipalTT 
ValidateTokenTT  -
(TT- .
stringTT. 4
jwTokenTT5 <
)TT< =
{UU 	$
IdentityModelEventSourceXX $
.XX$ %
ShowPIIXX% ,
=XX- .
trueXX/ 3
;XX3 4
SecurityTokenZZ 
validatedTokenZZ (
;ZZ( )%
TokenValidationParameters[[ % 
validationParameters[[& :
=[[; <
new[[= @%
TokenValidationParameters[[A Z
([[Z [
)[[[ \
;[[\ ] 
validationParameters]]  
.]]  !
ValidateLifetime]]! 1
=]]2 3
true]]4 8
;]]8 9 
validationParameters__  
.__  !
ValidAudience__! .
=__/ 0
_configuration__1 ?
[__? @
$str__@ O
]__O P
;__P Q 
validationParameters``  
.``  !
ValidIssuer``! ,
=``- .
_configuration``/ =
[``= >
$str``> M
]``M N
;``N O 
validationParametersaa  
.aa  !
IssuerSigningKeyaa! 1
=aa2 3
newaa4 7 
SymmetricSecurityKeyaa8 L
(aaL M
EncodingaaM U
.aaU V
UTF8aaV Z
.aaZ [
GetBytesaa[ c
(aac d
_configurationaad r
[aar s
$straas 
]	aa Ä
)
aaÄ Å
)
aaÅ Ç
;
aaÇ É
ClaimsPrincipalcc 
	principalcc %
=cc& '
newcc( +#
JwtSecurityTokenHandlercc, C
(ccC D
)ccD E
.ccE F
ValidateTokenccF S
(ccS T
jwTokenccT [
,cc[ \ 
validationParameterscc] q
,ccq r
outccs v
validatedToken	ccw Ö
)
ccÖ Ü
;
ccÜ á
returndd 
	principaldd 
;dd 
}ee 	
}ff 
}gg ∆€
hF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Controllers\ProductController.cs
	namespace 	
eShopeSolution
 
. 
	AddminApp "
." #
Controllers# .
{ 
public 

class 
ProductController "
:# $

Controller% /
{ 
private 
readonly 
IProductApiClient *
_productApiClient+ <
;< =
private 
readonly 
ICategoryApiClient +
_categoryApiClient, >
;> ?
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public 
ProductController  
(  !
IProductApiClient! 2
productApiClient3 C
,C D
IConfiguration 
configuration (
,( )
ICategoryApiClient* <
categoryApiClient= N
)N O
{ 	
_configuration 
= 
configuration *
;* +
_productApiClient 
= 
productApiClient  0
;0 1
_categoryApiClient 
=  
categoryApiClient! 2
;2 3
} 	
public"" 
async"" 
Task"" 
<"" 
IActionResult"" '
>""' (
Index"") .
("". /
int""/ 2
?""2 3

categoryId""4 >
,""> ?
string""@ F
keyword""G N
,""N O
int""P S
	pageIndex""T ]
=""^ _
$num""` a
,""a b
int""c f
pageSize""g o
=""p q
$num""r s
)""s t
{## 	
var$$ 

languageId$$ 
=$$ 
HttpContext$$ (
.$$( )
Session$$) 0
.$$0 1
	GetString$$1 :
($$: ;
SystemConstants$$; J
.$$J K
AppSettings$$K V
.$$V W
DefaultLanguageId$$W h
)$$h i
;$$i j
var&& 
request&& 
=&& 
new&& )
GetManageProductPagingRequest&& ;
(&&; <
)&&< =
{'' 
KeyWord(( 
=(( 
keyword(( !
,((! "
	PageIndex)) 
=)) 
	pageIndex)) %
,))% &
PageSize** 
=** 
pageSize** #
,**# $

LanguageId++ 
=++ 

languageId++ '
,++' (

CategoryId,, 
=,, 

categoryId,, '
}-- 
;-- 
var.. 
data.. 
=.. 
await.. 
_productApiClient.. .
.... /
GetProductPagings../ @
(..@ A
request..A H
)..H I
;..I J
ViewBag// 
.// 
Keyword// 
=// 
keyword// %
;//% &
var11 

categories11 
=11 
await11 "
_categoryApiClient11# 5
.115 6
GetAll116 <
(11< =

languageId11= G
)11G H
;11H I
ViewBag22 
.22 

Categories22 
=22  

categories22! +
.22+ ,
	ResultObj22, 5
.225 6
Select226 <
(22< =
x22= >
=>22? A
new22B E
SelectListItem22F T
(22T U
)22U V
{33 
Text44 
=44 
x44 
.44 
Name44 
,44 
Value55 
=55 
x55 
.55 
Id55 
.55 
ToString55 %
(55% &
)55& '
,55' (
Selected77 
=77 

categoryId77 %
.77% &
HasValue77& .
&&77/ 1

categoryId772 <
.77< =
Value77= B
==77C E
x77F G
.77G H
Id77H J
}88 
)88 
;88 
if99 
(99 
TempData99 
[99 
$str99 !
]99! "
!=99# %
null99& *
)99* +
{:: 
ViewBag;; 
.;; 

SuccessMsg;; "
=;;# $
TempData;;% -
[;;- .
$str;;. 6
];;6 7
;;;7 8
}<< 
return== 
View== 
(== 
data== 
.== 
	ResultObj== &
)==& '
;==' (
}>> 	
[@@ 	
HttpGet@@	 
]@@ 
publicAA 
asyncAA 
TaskAA 
<AA 
IActionResultAA '
>AA' (
DetailsAA) 0
(AA0 1
intAA1 4
IdAA5 7
,AA7 8
stringAA9 ?

LanguageIdAA@ J
)AAJ K
{BB 	
varEE 
resultEE 
=EE 
awaitEE 
_productApiClientEE 0
.EE0 1
GetByIdEE1 8
(EE8 9
IdEE9 ;
,EE; <

LanguageIdEE= G
)EEG H
;EEH I
returnFF 
ViewFF 
(FF 
resultFF 
)FF 
;FF  
}GG 	
[II 	
HttpGetII	 
]II 
publicJJ 
IActionResultJJ 
CreateJJ #
(JJ# $
)JJ$ %
{KK 	
returnLL 
ViewLL 
(LL 
)LL 
;LL 
}MM 	
[OO 	
HttpPostOO	 
]OO 
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
IActionResultQQ '
>QQ' (
CreateQQ) /
(QQ/ 0
[QQ0 1
FromFormQQ1 9
]QQ9 : 
ProductCreateRequestQQ; O
requestQQP W
)QQW X
{RR 	
ifTT 
(TT 
!TT 

ModelStateTT 
.TT 
IsValidTT #
)TT# $
returnUU 
ViewUU 
(UU 
)UU 
;UU 
varVV 
resultVV 
=VV 
awaitVV 
_productApiClientVV 0
.VV0 1
CreateProductVV1 >
(VV> ?
requestVV? F
)VVF G
;VVG H
ifXX 
(XX 
resultXX 
)XX 
{YY 
TempDataZZ 
[ZZ 
$strZZ !
]ZZ! "
=ZZ# $
$strZZ% C
;ZZC D
return[[ 
RedirectToAction[[ '
([[' (
$str[[( /
)[[/ 0
;[[0 1
}\\ 

ModelState^^ 
.^^ 
AddModelError^^ $
(^^$ %
$str^^% '
,^^' (
$str^^) A
)^^A B
;^^B C
return__ 
View__ 
(__ 
request__ 
)__  
;__  !
}`` 	
[bb 	
HttpGetbb	 
]bb 
publiccc 
IActionResultcc 
CreateImagecc (
(cc( )
intcc) ,
	productIdcc- 6
)cc6 7
{dd 	
varee 
PrImageRequsetee 
=ee  
newee! $%
ProductImageCreateRequestee% >
(ee> ?
)ee? @
{ff 
	ProductIdgg 
=gg 
	productIdgg %
}ii 
;ii 
returnjj 
Viewjj 
(jj 
PrImageRequsetjj &
)jj& '
;jj' (
}kk 	
[mm 	
HttpPostmm	 
]mm 
[nn 	
Consumesnn	 
(nn 
$strnn '
)nn' (
]nn( )
publicoo 
asyncoo 
Taskoo 
<oo 
IActionResultoo '
>oo' (
CreateImageoo) 4
(oo4 5
[oo5 6
FromFormoo6 >
]oo> ?%
ProductImageCreateRequestoo@ Y
requestooZ a
)ooa b
{pp 	
ifrr 
(rr 
!rr 

ModelStaterr 
.rr 
IsValidrr #
)rr# $
returnss 
Viewss 
(ss 
)ss 
;ss 
vartt 
resulttt 
=tt 
awaittt 
_productApiClienttt 0
.tt0 1
CreateImagett1 <
(tt< =
requesttt= D
)ttD E
;ttE F
ifuu 
(uu 
resultuu 
)uu 
{vv 
TempDataww 
[ww 
$strww !
]ww! "
=ww# $
$strww% >
;ww> ?
returnxx 
RedirectToActionxx '
(xx' (
$strxx( /
)xx/ 0
;xx0 1
}yy 

ModelState{{ 
.{{ 
AddModelError{{ $
({{$ %
$str{{% '
,{{' (
$str{{) <
){{< =
;{{= >
return|| 
View|| 
(|| 
request|| 
)||  
;||  !
}}} 	
[ 	
HttpGet	 
] 
public
ÄÄ 
async
ÄÄ 
Task
ÄÄ 
<
ÄÄ 
IActionResult
ÄÄ '
>
ÄÄ' (
Edit
ÄÄ) -
(
ÄÄ- .
int
ÄÄ. 1
id
ÄÄ2 4
,
ÄÄ4 5
string
ÄÄ6 <

LanguageId
ÄÄ= G
)
ÄÄG H
{
ÅÅ 	
var
ÑÑ 
result
ÑÑ 
=
ÑÑ 
await
ÑÑ 
_productApiClient
ÑÑ 0
.
ÑÑ0 1
GetById
ÑÑ1 8
(
ÑÑ8 9
id
ÑÑ9 ;
,
ÑÑ; <

LanguageId
ÑÑ= G
)
ÑÑG H
;
ÑÑH I
if
ÜÜ 
(
ÜÜ 
result
ÜÜ 
!=
ÜÜ 
null
ÜÜ 
)
ÜÜ 
{
áá 
var
àà 
ProductRequest
àà "
=
àà# $
new
àà% ("
ProductUpdateRequest
àà) =
(
àà= >
)
àà> ?
{
ââ 
Name
ää 
=
ää 
result
ää !
.
ää! "
Name
ää" &
,
ää& '
Description
ãã 
=
ãã  !
result
ãã" (
.
ãã( )
Description
ãã) 4
,
ãã4 5
Details
åå 
=
åå 
result
åå $
.
åå$ %
Details
åå% ,
,
åå, -
SeoAlias
çç 
=
çç 
result
çç %
.
çç% &
SeoAlias
çç& .
,
çç. /
SeoDescription
éé "
=
éé# $
result
éé% +
.
éé+ ,
SeoDescription
éé, :
,
éé: ;
SeoTitle
èè 
=
èè 
result
èè %
.
èè% &
SeoTitle
èè& .
,
èè. /
Id
êê 
=
êê 
id
êê 
,
êê 

LanguageId
ëë 
=
ëë  

LanguageId
ëë! +
,
ëë+ ,

IsFeatured
íí 
=
íí 
result
íí %
.
íí% &

IsFeatured
íí& 0
==
íí0 2
null
íí2 6
?
íí6 7
false
íí7 <
:
íí< =
result
íí= C
.
ííC D

IsFeatured
ííD N
.
ííN O
Value
ííO T
}
ìì 
;
ìì 
return
ïï 
View
ïï 
(
ïï 
ProductRequest
ïï *
)
ïï* +
;
ïï+ ,
}
ññ 
return
óó 
RedirectToAction
óó #
(
óó# $
$str
óó$ +
,
óó+ ,
$str
óó- 3
)
óó3 4
;
óó4 5
}
òò 	
[
öö 	
HttpPost
öö	 
]
öö 
public
õõ 
async
õõ 
Task
õõ 
<
õõ 
IActionResult
õõ '
>
õõ' (
Edit
õõ) -
(
õõ- ."
ProductUpdateRequest
õõ. B
request
õõC J
)
õõJ K
{
úú 	
if
ùù 
(
ùù 
!
ùù 

ModelState
ùù 
.
ùù 
IsValid
ùù #
)
ùù# $
return
ûû 
View
ûû 
(
ûû 
)
ûû 
;
ûû 
var
†† 
result
†† 
=
†† 
await
†† 
_productApiClient
†† 0
.
††0 1
UpdateProduct
††1 >
(
††> ?
request
††? F
)
††F G
;
††G H
if
°° 
(
°° 
result
°° 
>
°° 
$num
°° 
)
°° 
{
¢¢ 
TempData
§§ 
[
§§ 
$str
§§ !
]
§§! "
=
§§# $
$str
§§% 5
;
§§5 6
return
•• 
RedirectToAction
•• '
(
••' (
$str
••( /
)
••/ 0
;
••0 1
}
¶¶ 
return
®® 
View
®® 
(
®® 
request
®® 
)
®®  
;
®®  !
}
©© 	
[
´´ 	
HttpGet
´´	 
]
´´ 
public
¨¨ 
async
¨¨ 
Task
¨¨ 
<
¨¨ 
IActionResult
¨¨ '
>
¨¨' (
	EditPrice
¨¨) 2
(
¨¨2 3
int
¨¨3 6
id
¨¨7 9
,
¨¨9 :
string
¨¨; A

LanguageId
¨¨B L
)
¨¨L M
{
≠≠ 	
var
∞∞ 
result
∞∞ 
=
∞∞ 
await
∞∞ 
_productApiClient
∞∞ 0
.
∞∞0 1
GetById
∞∞1 8
(
∞∞8 9
id
∞∞9 ;
,
∞∞; <

LanguageId
∞∞= G
)
∞∞G H
;
∞∞H I
if
≤≤ 
(
≤≤ 
result
≤≤ 
!=
≤≤ 
null
≤≤ 
)
≤≤ 
{
≥≥ 
var
¥¥ 
prVm
¥¥ 
=
¥¥ 
new
¥¥ 
	ProductVm
¥¥ (
(
¥¥( )
)
¥¥) *
{
µµ 
Price
∂∂ 
=
∂∂ 
result
∂∂ "
.
∂∂" #
Price
∂∂# (
,
∂∂( )
Id
∑∑ 
=
∑∑ 
result
∑∑ 
.
∑∑  
Id
∑∑  "
,
∑∑" #
}
∏∏ 
;
∏∏ 
return
∫∫ 
View
∫∫ 
(
∫∫ 
prVm
∫∫  
)
∫∫  !
;
∫∫! "
}
ªª 
return
ºº 
RedirectToAction
ºº #
(
ºº# $
$str
ºº$ +
,
ºº+ ,
$str
ºº- 3
)
ºº3 4
;
ºº4 5
}
ΩΩ 	
[
øø 	
HttpPost
øø	 
]
øø 
public
¿¿ 
async
¿¿ 
Task
¿¿ 
<
¿¿ 
IActionResult
¿¿ '
>
¿¿' (
	EditPrice
¿¿) 2
(
¿¿2 3
int
¿¿3 6
id
¿¿7 9
,
¿¿9 :
decimal
¿¿; B
Price
¿¿C H
)
¿¿H I
{
¡¡ 	
if
¬¬ 
(
¬¬ 
!
¬¬ 

ModelState
¬¬ 
.
¬¬ 
IsValid
¬¬ #
)
¬¬# $
return
√√ 
View
√√ 
(
√√ 
)
√√ 
;
√√ 
var
≈≈ 
result
≈≈ 
=
≈≈ 
await
≈≈ 
_productApiClient
≈≈ 0
.
≈≈0 1
UpdatePrice
≈≈1 <
(
≈≈< =
id
≈≈= ?
,
≈≈? @
Price
≈≈A F
)
≈≈F G
;
≈≈G H
if
∆∆ 
(
∆∆ 
result
∆∆ 
)
∆∆ 
{
«« 
TempData
»» 
[
»» 
$str
»» !
]
»»! "
=
»»# $
$str
»»% 5
;
»»5 6
return
…… 
RedirectToAction
…… '
(
……' (
$str
……( /
)
……/ 0
;
……0 1
}
   
return
ÃÃ 
View
ÃÃ 
(
ÃÃ 
)
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
[
œœ 	
HttpGet
œœ	 
]
œœ 
public
–– 
async
–– 
Task
–– 
<
–– 
IActionResult
–– '
>
––' (
	EditImage
––) 2
(
––2 3
int
––3 6
imageId
––7 >
)
––> ?
{
—— 	
var
‘‘ 
result
‘‘ 
=
‘‘ 
await
‘‘ 
_productApiClient
‘‘ 0
.
‘‘0 1
GetImageById
‘‘1 =
(
‘‘= >
imageId
‘‘> E
)
‘‘E F
;
‘‘F G
if
÷÷ 
(
÷÷ 
result
÷÷ 
!=
÷÷ 
null
÷÷ 
)
÷÷ 
{
◊◊ 
var
ÿÿ 
	prImageVm
ÿÿ 
=
ÿÿ 
new
ÿÿ  #'
ProductImageUpdateRequest
ÿÿ$ =
(
ÿÿ= >
)
ÿÿ> ?
{
ŸŸ 
Caption
⁄⁄ 
=
⁄⁄ 
result
⁄⁄ $
.
⁄⁄$ %
Caption
⁄⁄% ,
,
⁄⁄, -
Id
€€ 
=
€€ 
result
€€ 
.
€€  
Id
€€  "
,
€€" #
	Isdefault
‹‹ 
=
‹‹ 
result
‹‹  &
.
‹‹& '
	Isdefault
‹‹' 0
,
‹‹0 1
	SortOrder
›› 
=
›› 
result
››  &
.
››& '
	SortOrder
››' 0
}
ﬁﬁ 
;
ﬁﬁ 
return
‡‡ 
View
‡‡ 
(
‡‡ 
	prImageVm
‡‡ %
)
‡‡% &
;
‡‡& '
}
·· 
return
‚‚ 
RedirectToAction
‚‚ #
(
‚‚# $
$str
‚‚$ +
,
‚‚+ ,
$str
‚‚- 3
)
‚‚3 4
;
‚‚4 5
}
„„ 	
[
ÂÂ 	
HttpPost
ÂÂ	 
]
ÂÂ 
public
ÊÊ 
async
ÊÊ 
Task
ÊÊ 
<
ÊÊ 
IActionResult
ÊÊ '
>
ÊÊ' (
	EditImage
ÊÊ) 2
(
ÊÊ2 3'
ProductImageUpdateRequest
ÊÊ3 L
request
ÊÊM T
)
ÊÊT U
{
ÁÁ 	
if
ËË 
(
ËË 
!
ËË 

ModelState
ËË 
.
ËË 
IsValid
ËË #
)
ËË# $
return
ÈÈ 
View
ÈÈ 
(
ÈÈ 
)
ÈÈ 
;
ÈÈ 
var
ÎÎ 
result
ÎÎ 
=
ÎÎ 
await
ÎÎ 
_productApiClient
ÎÎ 0
.
ÎÎ0 1
UpDateImage
ÎÎ1 <
(
ÎÎ< =
request
ÎÎ= D
)
ÎÎD E
;
ÎÎE F
if
ÏÏ 
(
ÏÏ 
result
ÏÏ 
>
ÏÏ 
$num
ÏÏ 
)
ÏÏ 
{
ÌÌ 
TempData
ÓÓ 
[
ÓÓ 
$str
ÓÓ !
]
ÓÓ! "
=
ÓÓ# $
$str
ÓÓ% 5
;
ÓÓ5 6
return
ÔÔ 
RedirectToAction
ÔÔ '
(
ÔÔ' (
$str
ÔÔ( /
)
ÔÔ/ 0
;
ÔÔ0 1
}
 
return
ÚÚ 
View
ÚÚ 
(
ÚÚ 
)
ÚÚ 
;
ÚÚ 
}
ÛÛ 	
[
ıı 	
HttpGet
ıı	 
]
ıı 
public
ˆˆ 
async
ˆˆ 
Task
ˆˆ 
<
ˆˆ 
IActionResult
ˆˆ '
>
ˆˆ' (
	EditStock
ˆˆ) 2
(
ˆˆ2 3
int
ˆˆ3 6
id
ˆˆ7 9
,
ˆˆ9 :
string
ˆˆ; A

LanguageId
ˆˆB L
)
ˆˆL M
{
˜˜ 	
var
˙˙ 
result
˙˙ 
=
˙˙ 
await
˙˙ 
_productApiClient
˙˙ 0
.
˙˙0 1
GetById
˙˙1 8
(
˙˙8 9
id
˙˙9 ;
,
˙˙; <

LanguageId
˙˙= G
)
˙˙G H
;
˙˙H I
if
¸¸ 
(
¸¸ 
result
¸¸ 
!=
¸¸ 
null
¸¸ 
)
¸¸ 
{
˝˝ 
var
˛˛ 
prVm
˛˛ 
=
˛˛ 
new
˛˛ 
	ProductVm
˛˛ (
(
˛˛( )
)
˛˛) *
{
ˇˇ 
Stock
ÄÄ 
=
ÄÄ 
result
ÄÄ "
.
ÄÄ" #
Stock
ÄÄ# (
,
ÄÄ( )
Id
ÅÅ 
=
ÅÅ 
result
ÅÅ 
.
ÅÅ  
Id
ÅÅ  "
,
ÅÅ" #
}
ÇÇ 
;
ÇÇ 
return
ÑÑ 
View
ÑÑ 
(
ÑÑ 
prVm
ÑÑ  
)
ÑÑ  !
;
ÑÑ! "
}
ÖÖ 
return
ÜÜ 
RedirectToAction
ÜÜ #
(
ÜÜ# $
$str
ÜÜ$ +
,
ÜÜ+ ,
$str
ÜÜ- 3
)
ÜÜ3 4
;
ÜÜ4 5
}
áá 	
[
ââ 	
HttpPost
ââ	 
]
ââ 
public
ää 
async
ää 
Task
ää 
<
ää 
IActionResult
ää '
>
ää' (
	EditStock
ää) 2
(
ää2 3
int
ää3 6
id
ää7 9
,
ää9 :
int
ää; >
Stock
ää? D
)
ääD E
{
ãã 	
if
åå 
(
åå 
!
åå 

ModelState
åå 
.
åå 
IsValid
åå #
)
åå# $
return
çç 
View
çç 
(
çç 
)
çç 
;
çç 
var
èè 
result
èè 
=
èè 
await
èè 
_productApiClient
èè 0
.
èè0 1
UpdateStock
èè1 <
(
èè< =
id
èè= ?
,
èè? @
Stock
èèA F
)
èèF G
;
èèG H
if
êê 
(
êê 
result
êê 
)
êê 
{
ëë 
TempData
íí 
[
íí 
$str
íí !
]
íí! "
=
íí# $
$str
íí% 5
;
íí5 6
return
ìì 
RedirectToAction
ìì '
(
ìì' (
$str
ìì( /
)
ìì/ 0
;
ìì0 1
}
îî 
return
ññ 
View
ññ 
(
ññ 
)
ññ 
;
ññ 
}
óó 	
[
ôô 	
HttpGet
ôô	 
]
ôô 
public
öö 
IActionResult
öö 
Delete
öö #
(
öö# $
int
öö$ '
id
öö( *
)
öö* +
{
õõ 	
return
úú 
View
úú 
(
úú 
new
úú "
ProductDeleteRequest
úú 0
(
úú0 1
)
úú1 2
{
ùù 
Id
ûû 
=
ûû 
id
ûû 
,
ûû 
}
üü 
)
üü 
;
üü 
}
†† 	
[
¢¢ 	
HttpPost
¢¢	 
]
¢¢ 
public
££ 
async
££ 
Task
££ 
<
££ 
IActionResult
££ '
>
££' (
Delete
££) /
(
££/ 0"
ProductDeleteRequest
££0 D
request
££E L
)
££L M
{
§§ 	
if
•• 
(
•• 
!
•• 

ModelState
•• 
.
•• 
IsValid
•• #
)
••# $
return
¶¶ 
View
¶¶ 
(
¶¶ 
)
¶¶ 
;
¶¶ 
var
ßß 
result
ßß 
=
ßß 
await
ßß 
_productApiClient
ßß 0
.
ßß0 1
Delete
ßß1 7
(
ßß7 8
request
ßß8 ?
.
ßß? @
Id
ßß@ B
)
ßßB C
;
ßßC D
if
®® 
(
®® 
result
®® 
)
®® 
{
©© 
TempData
´´ 
[
´´ 
$str
´´ !
]
´´! "
=
´´# $
$str
´´% 5
;
´´5 6
return
¨¨ 
RedirectToAction
¨¨ '
(
¨¨' (
$str
¨¨( /
)
¨¨/ 0
;
¨¨0 1
}
≠≠ 
return
ØØ 
View
ØØ 
(
ØØ 
request
ØØ 
)
ØØ  
;
ØØ  !
}
∞∞ 	
[
≤≤ 	
HttpGet
≤≤	 
]
≤≤ 
public
≥≥ 
async
≥≥ 
Task
≥≥ 
<
≥≥ 
IActionResult
≥≥ '
>
≥≥' (
CategoryAssign
≥≥) 7
(
≥≥7 8
int
≥≥8 ;
	productId
≥≥< E
)
≥≥E F
{
¥¥ 	
var
∑∑ 
roleAssignRequest
∑∑ !
=
∑∑" #
await
∑∑$ )&
GetCategoryAssignRequest
∑∑* B
(
∑∑B C
	productId
∑∑C L
)
∑∑L M
;
∑∑M N
return
ππ 
View
ππ 
(
ππ 
roleAssignRequest
ππ )
)
ππ) *
;
ππ* +
}
∫∫ 	
[
ºº 	
HttpPost
ºº	 
]
ºº 
public
ΩΩ 
async
ΩΩ 
Task
ΩΩ 
<
ΩΩ 
IActionResult
ΩΩ '
>
ΩΩ' (
CategoryAssign
ΩΩ) 7
(
ΩΩ7 8#
CategoryAssignRequest
ΩΩ8 M
request
ΩΩN U
)
ΩΩU V
{
ææ 	
if
øø 
(
øø 
!
øø 

ModelState
øø 
.
øø 
IsValid
øø #
)
øø# $
return
¿¿ 
View
¿¿ 
(
¿¿ 
)
¿¿ 
;
¿¿ 
var
¬¬ 
result
¬¬ 
=
¬¬ 
await
¬¬ 
_productApiClient
¬¬ 0
.
¬¬0 1
CategoryAssign
¬¬1 ?
(
¬¬? @
request
¬¬@ G
.
¬¬G H
Id
¬¬H J
,
¬¬J K
request
¬¬L S
)
¬¬S T
;
¬¬T U
if
√√ 
(
√√ 
result
√√ 
.
√√ 
IsSuccessed
√√ "
)
√√" #
{
ƒƒ 
TempData
≈≈ 
[
≈≈ 
$str
≈≈ !
]
≈≈! "
=
≈≈# $
$str
≈≈% C
;
≈≈C D
return
∆∆ 
RedirectToAction
∆∆ '
(
∆∆' (
$str
∆∆( /
)
∆∆/ 0
;
∆∆0 1
}
«« 

ModelState
…… 
.
…… 
AddModelError
…… $
(
……$ %
$str
……% '
,
……' (
result
……) /
.
……/ 0
Message
……0 7
)
……7 8
;
……8 9
var
ÀÀ 
roleAssignRequest
ÀÀ !
=
ÀÀ" #
await
ÀÀ$ )&
GetCategoryAssignRequest
ÀÀ* B
(
ÀÀB C
request
ÀÀC J
.
ÀÀJ K
Id
ÀÀK M
)
ÀÀM N
;
ÀÀN O
return
ÃÃ 
View
ÃÃ 
(
ÃÃ 
roleAssignRequest
ÃÃ )
)
ÃÃ) *
;
ÃÃ* +
}
ÕÕ 	
private
œœ 
async
œœ 
Task
œœ 
<
œœ #
CategoryAssignRequest
œœ 0
>
œœ0 1&
GetCategoryAssignRequest
œœ2 J
(
œœJ K
int
œœK N
id
œœO Q
)
œœQ R
{
–– 	
var
—— 

languageId
—— 
=
—— 
HttpContext
—— (
.
——( )
Session
——) 0
.
——0 1
	GetString
——1 :
(
——: ;
SystemConstants
——; J
.
——J K
AppSettings
——K V
.
——V W
DefaultLanguageId
——W h
)
——h i
;
——i j
var
”” 

productObj
”” 
=
”” 
await
”” "
_productApiClient
””# 4
.
””4 5
GetById
””5 <
(
””< =
id
””= ?
,
””? @

languageId
””A K
)
””K L
;
””L M
var
÷÷ 

categories
÷÷ 
=
÷÷ 
await
÷÷ " 
_categoryApiClient
÷÷# 5
.
÷÷5 6
GetAll
÷÷6 <
(
÷÷< =

languageId
÷÷= G
)
÷÷G H
;
÷÷H I
var
ÿÿ #
categoryAssignRequest
ÿÿ %
=
ÿÿ& '
new
ÿÿ( +#
CategoryAssignRequest
ÿÿ, A
(
ÿÿA B
)
ÿÿB C
;
ÿÿC D
foreach
ŸŸ 
(
ŸŸ 
var
ŸŸ 
category
ŸŸ !
in
ŸŸ" $

categories
ŸŸ% /
.
ŸŸ/ 0
	ResultObj
ŸŸ0 9
)
ŸŸ9 :
{
⁄⁄ #
categoryAssignRequest
€€ %
.
€€% &

Categories
€€& 0
.
€€0 1
Add
€€1 4
(
€€4 5
new
€€5 8

SelectItem
€€9 C
(
€€C D
)
€€D E
{
‹‹ 
Id
›› 
=
›› 
category
›› !
.
››! "
Id
››" $
.
››$ %
ToString
››% -
(
››- .
)
››. /
,
››/ 0
Name
ﬁﬁ 
=
ﬁﬁ 
category
ﬁﬁ #
.
ﬁﬁ# $
Name
ﬁﬁ$ (
,
ﬁﬁ( )
Selected
ﬂﬂ 
=
ﬂﬂ 

productObj
ﬂﬂ )
.
ﬂﬂ) *

Categories
ﬂﬂ* 4
.
ﬂﬂ4 5
Contains
ﬂﬂ5 =
(
ﬂﬂ= >
category
ﬂﬂ> F
.
ﬂﬂF G
Name
ﬂﬂG K
)
ﬂﬂK L
}
‡‡ 
)
‡‡ 
;
‡‡ 
}
·· #
categoryAssignRequest
„„ !
.
„„! "
Id
„„" $
=
„„% &
id
„„' )
;
„„) *
return
ÂÂ #
categoryAssignRequest
ÂÂ (
;
ÂÂ( )
}
ÊÊ 	
}
ÁÁ 
}ËË –{
eF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Controllers\UserController.cs
	namespace 	
eShopeSolution
 
. 
	AddminApp "
." #
Controllers# .
{ 
public 

class 
UserController 
:  !
BaseController" 0
{ 
private 
readonly 
IUserApiClient '
_userApiClient( 6
;6 7
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
private 
readonly 
IRoleApiClient '
_roleApiClient( 6
;6 7
public 
UserController 
( 
IUserApiClient ,
userApiClient- :
,: ;
IConfiguration< J
configurationK X
,X Y
IRoleApiClientZ h
roleApiClienti v
)v w
{ 	
_userApiClient 
= 
userApiClient *
;* +
_configuration 
= 
configuration *
;* +
_roleApiClient 
= 
roleApiClient *
;* +
} 	
public!! 
async!! 
Task!! 
<!! 
IActionResult!! '
>!!' (
Index!!) .
(!!. /
string!!/ 5
keyword!!6 =
,!!= >
int!!? B
	pageIndex!!C L
=!!M N
$num!!O P
,!!P Q
int!!R U
pageSize!!V ^
=!!_ `
$num!!a b
)!!b c
{"" 	
var&& 
request&& 
=&& 
new&&  
GetUserPagingRequest&& 2
(&&2 3
)&&3 4
{'' 
	PageIndex(( 
=(( 
	pageIndex(( %
,((% &
PageSize)) 
=)) 
pageSize)) #
,))# $
KeyWord** 
=** 
keyword** !
}++ 
;++ 
var,, 
data,, 
=,, 
await,, 
_userApiClient,, +
.,,+ ,
GetUsersPagings,,, ;
(,,; <
request,,< C
),,C D
;,,D E
if.. 
(.. 
keyword.. 
!=.. 
null.. 
)..  
ViewBag// 
.// 
keyword// 
=//  !
keyword//" )
;//) *
if11 
(11 
TempData11 
[11 
$str11 !
]11! "
!=11# %
null11& *
)11* +
{22 
ViewBag44 
.44 

SuccessMsg44 "
=44# $
TempData44% -
[44- .
$str44. 6
]446 7
;447 8
}55 
return77 
View77 
(77 
data77 
.77 
	ResultObj77 &
)77& '
;77' (
}88 	
[:: 	
HttpGet::	 
]:: 
public;; 
async;; 
Task;; 
<;; 
IActionResult;; '
>;;' (
Details;;) 0
(;;0 1
Guid;;1 5
Id;;6 8
);;8 9
{<< 	
var?? 
result?? 
=?? 
await?? 
_userApiClient?? -
.??- .
GetById??. 5
(??5 6
Id??6 8
)??8 9
;??9 :
return@@ 
View@@ 
(@@ 
result@@ 
.@@ 
	ResultObj@@ (
)@@( )
;@@) *
}AA 	
[DD 	
HttpGetDD	 
]DD 
publicEE 
IActionResultEE 
CreateEE #
(EE# $
)EE$ %
{FF 	
returnHH 
ViewHH 
(HH 
)HH 
;HH 
}II 	
[KK 	
HttpPostKK	 
]KK 
publicLL 
asyncLL 
TaskLL 
<LL 
IActionResultLL '
>LL' (
CreateLL) /
(LL/ 0
RegisterRequestLL0 ?
requestLL@ G
)LLG H
{MM 	
ifNN 
(NN 
!NN 

ModelStateNN 
.NN 
IsValidNN #
)NN# $
returnOO 
ViewOO 
(OO 
)OO 
;OO 
varPP 
resultPP 
=PP 
awaitPP 
_userApiClientPP -
.PP- .
RegisterUserPP. :
(PP: ;
requestPP; B
)PPB C
;PPC D
ifQQ 
(QQ 
resultQQ 
.QQ 
IsSuccessedQQ "
)QQ" #
{RR 
TempDataTT 
[TT 
$strTT !
]TT! "
=TT# $
$strTT% 6
;TT6 7
returnUU 
RedirectToActionUU '
(UU' (
$strUU( /
)UU/ 0
;UU0 1
}VV 

ModelStateXX 
.XX 
AddModelErrorXX $
(XX$ %
$strXX% '
,XX' (
resultXX) /
.XX/ 0
MessageXX0 7
)XX7 8
;XX8 9
returnYY 
ViewYY 
(YY 
requestYY 
)YY  
;YY  !
}ZZ 	
[\\ 	
HttpGet\\	 
]\\ 
public]] 
async]] 
Task]] 
<]] 
IActionResult]] '
>]]' (
Edit]]) -
(]]- .
Guid]]. 2
id]]3 5
)]]5 6
{^^ 	
varaa 
resultaa 
=aa 
awaitaa 
_userApiClientaa -
.aa- .
GetByIdaa. 5
(aa5 6
idaa6 8
)aa8 9
;aa9 :
ifbb 
(bb 
resultbb 
.bb 
IsSuccessedbb "
)bb" #
{cc 
vardd 
userdd 
=dd 
resultdd !
.dd! "
	ResultObjdd" +
;dd+ ,
varee 
updateRequestee !
=ee" #
newee$ '
UserUpdateRequestee( 9
(ee9 :
)ee: ;
{ff 
Dobgg 
=gg 
usergg 
.gg 
Dobgg "
,gg" #
Emailhh 
=hh 
userhh  
.hh  !
Emailhh! &
,hh& '
	FirstNameii 
=ii 
userii  $
.ii$ %
	FirstNameii% .
,ii. /
LastNamejj 
=jj 
userjj #
.jj# $
LastNamejj$ ,
,jj, -
PhoneNumberkk 
=kk  !
userkk" &
.kk& '
PhoneNumberkk' 2
,kk2 3
Idll 
=ll 
idll 
}mm 
;mm 
returnnn 
Viewnn 
(nn 
updateRequestnn )
)nn) *
;nn* +
}oo 
returnpp 
RedirectToActionpp #
(pp# $
$strpp$ +
,pp+ ,
$strpp- 3
)pp3 4
;pp4 5
}qq 	
[ss 	
HttpPostss	 
]ss 
publictt 
asynctt 
Tasktt 
<tt 
IActionResulttt '
>tt' (
Edittt) -
(tt- .
UserUpdateRequesttt. ?
requesttt@ G
)ttG H
{uu 	
ifvv 
(vv 
!vv 

ModelStatevv 
.vv 
IsValidvv #
)vv# $
returnww 
Viewww 
(ww 
)ww 
;ww 
varyy 
resultyy 
=yy 
awaityy 
_userApiClientyy -
.yy- .

UpdateUseryy. 8
(yy8 9
requestyy9 @
.yy@ A
IdyyA C
,yyC D
requestyyE L
)yyL M
;yyM N
ifzz 
(zz 
resultzz 
.zz 
IsSuccessedzz "
)zz" #
{{{ 
TempData}} 
[}} 
$str}} !
]}}! "
=}}# $
$str}}% 5
;}}5 6
return~~ 
RedirectToAction~~ '
(~~' (
$str~~( /
)~~/ 0
;~~0 1
} 

ModelState
ÅÅ 
.
ÅÅ 
AddModelError
ÅÅ $
(
ÅÅ$ %
$str
ÅÅ% '
,
ÅÅ' (
result
ÅÅ) /
.
ÅÅ/ 0
Message
ÅÅ0 7
)
ÅÅ7 8
;
ÅÅ8 9
return
ÇÇ 
View
ÇÇ 
(
ÇÇ 
request
ÇÇ 
)
ÇÇ  
;
ÇÇ  !
}
ÉÉ 	
public
ÜÜ 
async
ÜÜ 
Task
ÜÜ 
<
ÜÜ 
IActionResult
ÜÜ '
>
ÜÜ' (
Logout
ÜÜ) /
(
ÜÜ/ 0
)
ÜÜ0 1
{
áá 	
await
àà 
HttpContext
àà 
.
àà 
SignOutAsync
àà *
(
àà* +*
CookieAuthenticationDefaults
àà+ G
.
ààG H"
AuthenticationScheme
ààH \
)
àà\ ]
;
àà] ^
HttpContext
ää 
.
ää 
Session
ää 
.
ää  
Remove
ää  &
(
ää& '
$str
ää' .
)
ää. /
;
ää/ 0
return
åå 
RedirectToAction
åå #
(
åå# $
$str
åå$ +
,
åå+ ,
$str
åå- 4
)
åå4 5
;
åå5 6
}
çç 	
[
êê 	
HttpGet
êê	 
]
êê 
public
ëë 
IActionResult
ëë 
Delete
ëë #
(
ëë# $
Guid
ëë$ (
id
ëë) +
)
ëë+ ,
{
íí 	
return
ìì 
View
ìì 
(
ìì 
new
ìì 
UserDeleteRequest
ìì -
(
ìì- .
)
ìì. /
{
îî 
Id
ïï 
=
ïï 
id
ïï 
,
ïï 
}
ññ 
)
ññ 
;
ññ 
}
óó 	
[
ôô 	
HttpPost
ôô	 
]
ôô 
public
öö 
async
öö 
Task
öö 
<
öö 
IActionResult
öö '
>
öö' (
Delete
öö) /
(
öö/ 0
UserDeleteRequest
öö0 A
request
ööB I
)
ööI J
{
õõ 	
if
úú 
(
úú 
!
úú 

ModelState
úú 
.
úú 
IsValid
úú #
)
úú# $
return
ùù 
View
ùù 
(
ùù 
)
ùù 
;
ùù 
var
ûû 
result
ûû 
=
ûû 
await
ûû 
_userApiClient
ûû -
.
ûû- .
Delete
ûû. 4
(
ûû4 5
request
ûû5 <
.
ûû< =
Id
ûû= ?
)
ûû? @
;
ûû@ A
if
üü 
(
üü 
result
üü 
.
üü 
IsSuccessed
üü "
)
üü" #
{
†† 
TempData
¢¢ 
[
¢¢ 
$str
¢¢ !
]
¢¢! "
=
¢¢# $
$str
¢¢% 5
;
¢¢5 6
return
££ 
RedirectToAction
££ '
(
££' (
$str
££( /
)
££/ 0
;
££0 1
}
§§ 

ModelState
¶¶ 
.
¶¶ 
AddModelError
¶¶ $
(
¶¶$ %
$str
¶¶% '
,
¶¶' (
result
¶¶) /
.
¶¶/ 0
Message
¶¶0 7
)
¶¶7 8
;
¶¶8 9
return
ßß 
View
ßß 
(
ßß 
request
ßß 
)
ßß  
;
ßß  !
}
®® 	
[
™™ 	
HttpGet
™™	 
]
™™ 
public
´´ 
async
´´ 
Task
´´ 
<
´´ 
IActionResult
´´ '
>
´´' (

RoleAssign
´´) 3
(
´´3 4
Guid
´´4 8
id
´´9 ;
)
´´; <
{
¨¨ 	
var
ØØ 
roleAssignRequest
ØØ !
=
ØØ" #
await
ØØ$ )"
GetRoleAssignRequest
ØØ* >
(
ØØ> ?
id
ØØ? A
)
ØØA B
;
ØØB C
return
±± 
View
±± 
(
±± 
roleAssignRequest
±± )
)
±±) *
;
±±* +
}
≤≤ 	
[
¥¥ 	
HttpPost
¥¥	 
]
¥¥ 
public
µµ 
async
µµ 
Task
µµ 
<
µµ 
IActionResult
µµ '
>
µµ' (

RoleAssign
µµ) 3
(
µµ3 4
RoleAssignRequest
µµ4 E
request
µµF M
)
µµM N
{
∂∂ 	
if
∑∑ 
(
∑∑ 
!
∑∑ 

ModelState
∑∑ 
.
∑∑ 
IsValid
∑∑ #
)
∑∑# $
return
∏∏ 
View
∏∏ 
(
∏∏ 
)
∏∏ 
;
∏∏ 
var
∫∫ 
result
∫∫ 
=
∫∫ 
await
∫∫ 
_userApiClient
∫∫ -
.
∫∫- .

RoleAssign
∫∫. 8
(
∫∫8 9
request
∫∫9 @
.
∫∫@ A
Id
∫∫A C
,
∫∫C D
request
∫∫E L
)
∫∫L M
;
∫∫M N
if
ªª 
(
ªª 
result
ªª 
.
ªª 
IsSuccessed
ªª "
)
ªª" #
{
ºº 
TempData
ΩΩ 
[
ΩΩ 
$str
ΩΩ !
]
ΩΩ! "
=
ΩΩ# $
$str
ΩΩ% <
;
ΩΩ< =
return
ææ 
RedirectToAction
ææ '
(
ææ' (
$str
ææ( /
)
ææ/ 0
;
ææ0 1
}
øø 

ModelState
¡¡ 
.
¡¡ 
AddModelError
¡¡ $
(
¡¡$ %
$str
¡¡% '
,
¡¡' (
result
¡¡) /
.
¡¡/ 0
Message
¡¡0 7
)
¡¡7 8
;
¡¡8 9
var
√√ 
roleAssignRequest
√√ !
=
√√" #
await
√√$ )"
GetRoleAssignRequest
√√* >
(
√√> ?
request
√√? F
.
√√F G
Id
√√G I
)
√√I J
;
√√J K
return
ƒƒ 
View
ƒƒ 
(
ƒƒ 
roleAssignRequest
ƒƒ )
)
ƒƒ) *
;
ƒƒ* +
}
≈≈ 	
private
«« 
async
«« 
Task
«« 
<
«« 
RoleAssignRequest
«« ,
>
««, -"
GetRoleAssignRequest
««. B
(
««B C
Guid
««C G
id
««H J
)
««J K
{
»» 	
var
…… 
userObj
…… 
=
…… 
await
…… 
_userApiClient
……  .
.
……. /
GetById
……/ 6
(
……6 7
id
……7 9
)
……9 :
;
……: ;
var
ÃÃ 
roleObj
ÃÃ 
=
ÃÃ 
await
ÃÃ 
_roleApiClient
ÃÃ  .
.
ÃÃ. /
GetAll
ÃÃ/ 5
(
ÃÃ5 6
)
ÃÃ6 7
;
ÃÃ7 8
var
ŒŒ 
roleAssignRequest
ŒŒ !
=
ŒŒ" #
new
ŒŒ$ '
RoleAssignRequest
ŒŒ( 9
(
ŒŒ9 :
)
ŒŒ: ;
;
ŒŒ; <
foreach
œœ 
(
œœ 
var
œœ 
role
œœ 
in
œœ  
roleObj
œœ! (
.
œœ( )
	ResultObj
œœ) 2
)
œœ2 3
{
–– 
roleAssignRequest
—— !
.
——! "
Roles
——" '
.
——' (
Add
——( +
(
——+ ,
new
——, /

SelectItem
——0 :
(
——: ;
)
——; <
{
““ 
Id
”” 
=
”” 
role
”” 
.
”” 
Id
””  
.
””  !
ToString
””! )
(
””) *
)
””* +
,
””+ ,
Name
‘‘ 
=
‘‘ 
role
‘‘ 
.
‘‘  
Name
‘‘  $
,
‘‘$ %
Selected
’’ 
=
’’ 
userObj
’’ &
.
’’& '
	ResultObj
’’' 0
.
’’0 1
Roles
’’1 6
.
’’6 7
Contains
’’7 ?
(
’’? @
role
’’@ D
.
’’D E
Name
’’E I
)
’’I J
}
÷÷ 
)
÷÷ 
;
÷÷ 
}
◊◊ 
return
ŸŸ 
roleAssignRequest
ŸŸ $
;
ŸŸ$ %
}
⁄⁄ 	
}
€€ 
}‹‹ ÷
`F:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Models\ErrorViewModel.cs
	namespace 	
eShopeSolution
 
. 
	AddminApp "
." #
Models# )
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
	RequestId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 Ù
eF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Models\NavigationViewModel.cs
	namespace 	
eShopeSolution
 
. 
	AddminApp "
." #
Models# )
{ 
public 

class 
NavigationViewModel $
{ 
public 
List 
< 

LanguageVm 
> 
	Languages  )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public

 
string

 
CurrentLanguageId

 '
{

( )
get

* -
;

- .
set

/ 2
;

2 3
}

4 5
public 
string 
	ReturnUrl 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} ‘

RF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Program.cs
	namespace 	
eShopeSolution
 
. 
	AddminApp "
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{		 	
CreateHostBuilder

 
(

 
args

 "
)

" #
.

# $
Build

$ )
(

) *
)

* +
.

+ ,
Run

, /
(

/ 0
)

0 1
;

1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ¡/
RF:\C#\Website\BackEnd\hocDuAnWEB\eShopSolution\eShopeSolution.AddminApp\Startup.cs
	namespace 	
eShopeSolution
 
. 
	AddminApp "
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddHttpClient "
(" #
)# $
;$ %
services 
. 
AddAuthentication &
(& '(
CookieAuthenticationDefaults' C
.C D 
AuthenticationSchemeD X
)X Y
.   
	AddCookie   
(   
options   "
=>  # %
{!! 
options"" 
."" 
	LoginPath"" %
=""& '
$str""( 6
;""6 7
options## 
.## 
AccessDeniedPath## ,
=##- .
$str##/ C
;##C D
}$$ 
)$$ 
;$$ 
services'' 
.'' #
AddControllersWithViews'' ,
('', -
)''- .
.(( 
AddFluentValidation(( $
((($ %
fv((% '
=>((( *
fv((+ -
.((- .4
(RegisterValidatorsFromAssemblyContaining((. V
<((V W!
LoginRequestValidator((W l
>((l m
(((m n
)((n o
)((o p
;((p q
services,, 
.,, 

AddSession,, 
(,,  
options,,  '
=>,,( *
{-- 
options// 
.// 
IdleTimeout// #
=//$ %
TimeSpan//& .
.//. /
FromMinutes/// :
(//: ;
$num//; =
)//= >
;//> ?
}00 
)00 
;00 
services33 
.33 
AddSingleton33 !
<33! " 
IHttpContextAccessor33" 6
,336 7
HttpContextAccessor338 K
>33K L
(33L M
)33M N
;33N O
services66 
.66 
AddTransient66 !
<66! "
IUserApiClient66" 0
,660 1
UserApiClient662 ?
>66? @
(66@ A
)66A B
;66B C
services77 
.77 
AddTransient77 !
<77! "
IRoleApiClient77" 0
,770 1
RoleApiClient772 ?
>77? @
(77@ A
)77A B
;77B C
services88 
.88 
AddTransient88 !
<88! "
ILanguageApiClient88" 4
,884 5
LanguageApiClient886 G
>88G H
(88H I
)88I J
;88J K
services99 
.99 
AddTransient99 !
<99! "
ICategoryApiClient99" 4
,994 5
CategoryApiClient996 G
>99G H
(99H I
)99I J
;99J K
services<< 
.<< 
AddTransient<< !
<<<! "
IProductApiClient<<" 3
,<<3 4
ProductApiClient<<5 E
><<E F
(<<F G
)<<G H
;<<H I
IMvcBuilder?? 
builder?? 
=??  !
services??" *
.??* +
AddRazorPages??+ 8
(??8 9
)??9 :
;??: ;
var@@ 
environment@@ 
=@@ 
Environment@@ )
.@@) *"
GetEnvironmentVariable@@* @
(@@@ A
$str@@A Y
)@@Y Z
;@@Z [
ifBB 
(BB 
environmentBB 
==BB 
EnvironmentsBB +
.BB+ ,
DevelopmentBB, 7
)BB7 8
{CC 
builderDD 
.DD &
AddRazorRuntimeCompilationDD 2
(DD2 3
)DD3 4
;DD4 5
}EE 
}HH 	
publicKK 
voidKK 
	ConfigureKK 
(KK 
IApplicationBuilderKK 1
appKK2 5
,KK5 6
IWebHostEnvironmentKK7 J
envKKK N
)KKN O
{LL 	
ifMM 
(MM 
envMM 
.MM 
IsDevelopmentMM !
(MM! "
)MM" #
)MM# $
{NN 
appOO 
.OO %
UseDeveloperExceptionPageOO -
(OO- .
)OO. /
;OO/ 0
}PP 
elseQQ 
{RR 
appSS 
.SS 
UseExceptionHandlerSS '
(SS' (
$strSS( 5
)SS5 6
;SS6 7
appUU 
.UU 
UseHstsUU 
(UU 
)UU 
;UU 
}VV 
appWW 
.WW 
UseHttpsRedirectionWW #
(WW# $
)WW$ %
;WW% &
appXX 
.XX 
UseStaticFilesXX 
(XX 
)XX  
;XX  !
app[[ 
.[[ 
UseAuthentication[[ !
([[! "
)[[" #
;[[# $
app]] 
.]] 

UseRouting]] 
(]] 
)]] 
;]] 
app__ 
.__ 
UseAuthorization__  
(__  !
)__! "
;__" #
appbb 
.bb 

UseSessionbb 
(bb 
)bb 
;bb 
appdd 
.dd 
UseEndpointsdd 
(dd 
	endpointsdd &
=>dd' )
{ee 
	endpointsff 
.ff 
MapControllerRouteff ,
(ff, -
namegg 
:gg 
$strgg #
,gg# $
patternhh 
:hh 
$strhh E
)hhE F
;hhF G
}ii 
)ii 
;ii 
}jj 	
}kk 
}ll 